tinymce.create("tinymce.plugins.Subscribe2Plugin",{init:function(t,e){var n=0,c='<p><img src="'+e+'/../include/spacer.gif" class="mceSubscribe2 mceItemNoResize" /></p>',i="mceSubscribe2",o=[],s=new RegExp(/(\[|<!--)subscribe2.*?(\]|-->)/g),r=function(e){return-1!==e.indexOf('class="mceSubscribe2')&&(e=o[n]),e};t.addCommand("mceSubscribe2",function(){t.execCommand("mceInsertContent",0,c)}),t.addButton("subscribe2",{title:"Insert Subscribe2 Token",image:e+"/../include/s2-button.png",cmd:i}),t.on("init",function(){t.dom.loadCSS(e+"/css/content.css"),t.theme.onResolveName&&t.theme.onResolveName.add(function(e,n){"IMG"===n.node.nodeName&&t.dom.hasClass(n.node,i)&&(n.name="subscribe2")})}),t.on("BeforeSetContent",function(e){o=e.content.match(s),e.content=e.content.replace(s,c)}),t.on("PostProcess",function(e){if(e.get){if(null!==o)for(n=0;n<o.length;n++)e.content=e.content.replace(/<img[^>]+>/,r);e.content=e.content.replace(/<img[^>]+>/g,function(e){return-1!==e.indexOf('class="mceSubscribe2')&&(e="[subscribe2]"),e})}})},getInfo:function(){return{longname:"Insert Subscribe2 Token",author:"Matthew Robinson",authorurl:"http://subscribe2.wordpress.com",infourl:"http://subscribe2.wordpress.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("subscribe2",tinymce.plugins.Subscribe2Plugin);